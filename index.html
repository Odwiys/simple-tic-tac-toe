<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic‚ÄëTac‚ÄëToe</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #121a2a;
      --muted: #9fb0c9;
      --text: #e8f0ff;
      --accent: #5dd3ff;
      --accent-2: #9effa8;
      --danger: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      background: radial-gradient(1200px 800px at 70% -10%, #1a2440 0%, var(--bg) 60%);
      color: var(--text); display: grid; place-items: center; padding: 24px;
    }
    .app { width: min(95vw, 560px); }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      backdrop-filter: blur(6px);
    }
    h1 { margin: 0 0 6px; font-size: 28px; letter-spacing: .4px; }
    .sub { color: var(--muted); margin-bottom: 18px; }

    .toolbar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 16px; }
    .seg {
      background: var(--panel); border-radius: 14px; padding: 6px; display: inline-flex; gap: 6px; border: 1px solid rgba(255,255,255,.06);
    }
    .seg button { 
      border: 0; background: transparent; color: var(--muted); padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 600;
    }
    .seg button.active { background: #1c2740; color: var(--accent); box-shadow: inset 0 0 0 1px rgba(93,211,255,.35); }
    .btn { border: 0; background: #1c2740; color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 700; letter-spacing: .2px; }
    .btn.secondary { background: #172138; color: var(--muted); font-weight: 600; }
    .btn.danger { background: #2b1720; color: #ffb4b4; }

    .board {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 14px;
    }
    .cell {
      aspect-ratio: 1 / 1; display: grid; place-items: center; font-size: clamp(40px, 8vw, 64px); font-weight: 900;
      border-radius: 16px; user-select: none; cursor: pointer; position: relative; transition: transform .05s ease;
      background: linear-gradient(180deg, #0f1730, #0b1428);
      border: 1px solid rgba(255,255,255,.08);
    }
    .cell:hover { transform: translateY(-1px); }
    .cell.disabled { cursor: not-allowed; opacity: .7; }
    .cell.x { color: var(--accent); text-shadow: 0 4px 14px rgba(93,211,255,.35); }
    .cell.o { color: var(--accent-2); text-shadow: 0 4px 14px rgba(158,255,168,.35); }
    .cell.win { outline: 3px solid rgba(255,255,255,.18); box-shadow: 0 0 0 3px rgba(93,211,255,.18) inset; }

    .status {
      margin-top: 14px; padding: 12px 14px; border-radius: 12px; background: #0f162a; color: var(--muted);
      border: 1px solid rgba(255,255,255,.06);
    }
    .status strong { color: var(--text); }
    .footer { display: flex; justify-content: space-between; align-items: center; margin-top: 14px; color: var(--muted); font-size: 13px; }
    .footer a { color: var(--accent); text-decoration: none; }
  </style>
</head>
<body>
  <main class="app card">
    <h1>‚ú® Tic‚ÄëTac‚ÄëToe</h1>
    <div class="sub">Play locally or vs. computer. Zero dependencies, all in one file.</div>

    <div class="toolbar">
      <div class="seg" role="tablist" aria-label="Mode">
        <button id="mode-human" class="active" aria-selected="true">üë• 2 Players</button>
        <button id="mode-ai" aria-selected="false">ü§ñ vs Computer</button>
      </div>
      <button id="reset" class="btn">‚Üª Reset</button>
      <button id="swap" class="btn secondary" title="Who starts first?">‚èØ First Player: <span id="firstLabel">X</span></button>
    </div>

    <div class="board" id="board" aria-label="Tic‚ÄëTac‚ÄëToe board"></div>

    <div class="status" id="status">Current turn: <strong>X</strong></div>

    <div class="footer">
      <div>Keyboard: 1‚Äë9 to place ‚Ä¢ R to reset</div>
      <a href="#" id="share">Share this game</a>
    </div>
  </main>

  <script>
    // --- Game State ---
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const resetBtn = document.getElementById('reset');
    const swapBtn  = document.getElementById('swap');
    const firstLabel = document.getElementById('firstLabel');
    const modeHumanBtn = document.getElementById('mode-human');
    const modeAiBtn = document.getElementById('mode-ai');

    let board = Array(9).fill(null); // values: 'X' | 'O' | null
    let xStarts = true;              // who starts when resetting
    let turn = 'X';
    let vsAI = false;
    const WIN_LINES = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    // --- UI Setup ---
    function render() {
      boardEl.innerHTML = '';
      board.forEach((v, i) => {
        const cell = document.createElement('button');
        cell.className = 'cell' + (v ? ' ' + v.toLowerCase() : '');
        cell.setAttribute('aria-label', `Cell ${i+1}`);
        cell.dataset.index = i;
        cell.textContent = v || '';
        if (winner() || v) cell.classList.add('disabled');
        cell.addEventListener('click', () => play(i));
        boardEl.appendChild(cell);
      });
      const w = winner();
      if (w) {
        statusEl.innerHTML = `Winner: <strong>${w.player}</strong>`;
        highlightWin(w.line);
      } else if (isFull()) {
        statusEl.innerHTML = `It\'s a <strong>draw</strong>.`;
      } else {
        statusEl.innerHTML = `Current turn: <strong>${turn}</strong>`;
      }
    }

    function highlightWin(line) {
      [...boardEl.children].forEach((c, i) => {
        if (line.includes(i)) c.classList.add('win');
      });
    }

    function isFull() { return board.every(x => x); }

    function winner() {
      for (const line of WIN_LINES) {
        const [a,b,c] = line;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return { player: board[a], line };
        }
      }
      return null;
    }

    function reset() {
      board = Array(9).fill(null);
      turn = xStarts ? 'X' : 'O';
      render();
      maybeAIMove();
    }

    // Toggle first player
    swapBtn.addEventListener('click', () => {
      xStarts = !xStarts;
      firstLabel.textContent = xStarts ? 'X' : 'O';
      reset();
    });

    // Mode switching
    function setMode(ai) {
      vsAI = ai;
      modeHumanBtn.classList.toggle('active', !ai);
      modeAiBtn.classList.toggle('active', ai);
      reset();
    }
    modeHumanBtn.addEventListener('click', () => setMode(false));
    modeAiBtn.addEventListener('click', () => setMode(true));

    // --- Game Logic ---
    function play(i) {
      if (board[i] || winner()) return;
      board[i] = turn;
      turn = turn === 'X' ? 'O' : 'X';
      render();
      maybeAIMove();
    }

    function maybeAIMove() {
      if (!vsAI) return;
      const w = winner();
      if (w || isFull()) return;
      if (turn === 'O') { // AI plays O by default
        // Small delay for UX
        setTimeout(() => {
          const move = bestMove('O');
          if (move != null) play(move);
        }, 220);
      }
    }

    // Unbeatable AI (minimax with small heuristics)
    function bestMove(ai) {
      const hu = ai === 'X' ? 'O' : 'X';
      // 1) Win now
      for (const i of emptyIdxs()) { if (wouldWin(i, ai)) return i; }
      // 2) Block opponent
      for (const i of emptyIdxs()) { if (wouldWin(i, hu)) return i; }
      // 3) Take center, then corners, then sides
      if (board[4] == null) return 4;
      const corners = [0,2,6,8].filter(i => board[i]==null);
      if (corners.length) return corners[Math.floor(Math.random()*corners.length)];
      const sides = [1,3,5,7].filter(i => board[i]==null);
      if (sides.length) return sides[Math.floor(Math.random()*sides.length)];
      return null;
    }

    function wouldWin(i, p) {
      board[i] = p;
      const winNow = !!winner();
      board[i] = null;
      return winNow;
    }

    function emptyIdxs(){ return board.map((v,i)=>v?null:i).filter(v=>v!=null); }

    // Controls
    resetBtn.addEventListener('click', reset);
    window.addEventListener('keydown', (e) => {
      if (e.key === 'r' || e.key === 'R') { reset(); return; }
      const map = { '1':0,'2':1,'3':2,'4':3,'5':4,'6':5,'7':6,'8':7,'9':8 };
      if (map[e.key] != null) play(map[e.key]);
    });

    // Share link (no external deps)
    document.getElementById('share').addEventListener('click', (e) => {
      e.preventDefault();
      const url = location.href;
      if (navigator.share) {
        navigator.share({ title: 'Tic‚ÄëTac‚ÄëToe', url });
      } else {
        navigator.clipboard.writeText(url).then(()=>{
          alert('Link copied to clipboard!');
        });
      }
    });

    // Init
    reset();
  </script>
</body>
</html>
